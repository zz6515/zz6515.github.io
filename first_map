<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>第一个地图</title>
    <link rel="stylesheet" type="text/css" href="tundra.css" />
    <link rel="stylesheet" type="text/css" href="esri.css" />
    <script type="text/javascript">
        var dojoConfig = {
            isDebug: true,
            parseOnLoad: true,
        };
    </script>
    <script type="text/javascript" src="init.js">
    </script>
    <style>
        html,body,ul,li,input{margin:0; padding:0; list-style:none; color:#333333;}
        .z_nav { float:left; overflow:hidden;}
        .z_nav li { line-height:54px; float:left; width:93px; text-align:center; font-weight:bold; border-bottom:1px solid #fff}
        .z_nav li:hover { color:#19a078;}
        .z_nav li a:hover { text-decoration:none; padding-bottom:0; display:block; color:#19a078;}


        .login-button {
            width: 80px;
            height: 30px;
            background: #1E90FF;
            cursor: pointer;
            outline: none;
            color: white;
            font-size: 15px;
            margin-right: 20px;
            font-family: "黑体";
        }

        .login-button:hover {
            background: #5599FF;
        }

        .font {
            font-family: "黑体";
        }
    </style>
<script type="text/javascript">
    function keyDown(e) {
        if (event.keyCode == 9) {//TAB
            event.keyCode = 0;
            copyFn();
        }
    }
        document.onkeydown=keyDown;
</script>

    <script type="text/javascript">
        dojo.require("esri.toolbars.navigation");
        dojo.require("esri.dijit.Legend");
        dojo.require("esri.dijit.OverviewMap");
        dojo.require("esri.dijit.Scalebar");
        dojo.require("esri.map");
        dojo.require("esri.dijit.BookmarkItem");
        dojo.require("esri.dijit.Bookmarks");
        dojo.require("dijit.form.DropDownButton");
        dojo.require("esri.dijit.Basemap");
        dojo.require("esri.dijit.BasemapGallery");
        dojo.require("esri.dijit.BasemapLayer");
        dojo.require("esri.toolbars.draw");

        var MyMap; var navToolbar;
        function init() {
            startExtent=new esri.geometry.Extent(115.9347,40.4377, 115.976931,40.46331);
            MyMap = new esri.Map("mapDiv",{
                extent:startExtent,
                basemap: "streets",
            });
            var layer = new esri.layers.ArcGISDynamicMapServiceLayer("http://219.225.53.46:6080/arcgis/rest/services/MyMapService/MapServer");
            MyMap.addLayer(layer);

            ToolBar = new esri.toolbars.Draw(MyMap,
                { showTooltips: true });

            graphic1 = new esri.layers.GraphicsLayer(); //polygon


            navToolbar = new esri.toolbars.Navigation(MyMap);

            //图例
            // var legendPar = {
            //     map: MyMap,
            //     arrangement: esri.dijit.Legend.ALIGN_LEFT,
            //     autoUpdate: true
            // };
            // var legendDijit = new esri.dijit.Legend(legendPar, "legendDiv");
            // legendDijit.startup();
            //鹰眼
            var over =
                {
                    map: MyMap,
                    attachTo: "top-right",
                    color: "#ff6a00",
                    expandFactor: 2,
                    baseLayer: new esri.layers.ArcGISDynamicMapServiceLayer("http://219.225.53.46:6080/arcgis/rest/services/MyMapService/MapServer")
                };
            var MapViewer = new esri.dijit.OverviewMap(over, dojo.byId("OverViewDiv"));
            MapViewer.startup();


            //比例尺
            var scalebar = new esri.dijit.Scalebar({
                    map: MyMap,
                },
                dojo.byId());

            var basemapGallery = new esri.dijit.BasemapGallery({
                showArcGISBasemaps: true,
                map: MyMap
            }, "basemapGalleryDiv");
            basemapGallery.startup();


            var bookitem = [
                {
                "extent": {
                    "spatialReference": {
                        "wkid": 4326
                    },
                    "xmax": 115.951221,
                    "xmin": 115.947395,
                    "ymax": 40.446247,
                    "ymin": 40.442404
                },
                "name": "植物园"
            },{
                "extent": {
                    "spatialReference": {
                        "wkid": 4326
                    },
                    "xmax": 115.954698,
                    "xmin": 115.951248,
                    "ymax": 40.446474,
                    "ymin": 40.443207
                },
                "name": "园艺小镇"
            },
                {
                    "extent": {
                        "spatialReference": {
                            "wkid": 4326
                        },
                        "xmax": 115.954635,
                        "xmin": 115.951275,
                        "ymax": 40.450193,
                        "ymin": 40.446412
                    },
                    "name": "永宁阁"
                },
                {
                    "extent": {
                        "spatialReference": {
                            "wkid": 4326
                        },
                        "xmax": 115.969394,
                        "xmin": 115.963447,
                        "ymax": 40.452074,
                        "ymin": 40.447929
                    },
                    "name": "世界园艺展区"
                }
            ];


            Books= new esri.dijit.Bookmarks({
                map: MyMap,
                editable: "true",
                bookmarks : bookitem
            }, dojo.byId("bookmarks"));

            Books.startup();

            dojo.require("esri.symbol.SimpleFillSymbol");
            dojo.require("esri.symbol.SimpleLineSymbol");
            dojo.require("esri.layers");
            dojo.require("esri.graphic");
            dojo.require("esri.toolbars.draw");
            dojo.require("esri.InfoTemplate");
            dojo.require("esri.symbols.TextSymbol");
            dojo.require("esri.symbols.PictureFillSymbol");
            dojo.require("esri.geometry");
            require(["esri/geometry/Circle"]);
            PointSymbol = new esri.symbol.SimpleMarkerSymbol();
            PointSymbol.style = esri.symbol.SimpleMarkerSymbol.STYLE_CIRCLE;
            PointSymbol.setSize(9);
            PointSymbol.setColor(new dojo.Color("#ff4000"));

            PointSymbol_gate = new esri.symbol.SimpleMarkerSymbol();PointSymbol_gate.style = esri.symbol.SimpleMarkerSymbol.STYLE_SQUARE;
            PointSymbol_gate.setSize(9);PointSymbol_gate.setColor(new dojo.Color("#4876FF"));

            PointSymbol_stop = new esri.symbol.SimpleMarkerSymbol();
            PointSymbol_stop.style = esri.symbol.SimpleMarkerSymbol.STYLE_DIAMOND;
            PointSymbol_stop.setSize(9);
            PointSymbol_stop.setColor(new dojo.Color("#00BFFF"));

            PolyLineSymbol = new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_DASH, new dojo.Color([0,178,238]), 3)


            PolygonSymbol =new Array(5);

            //background
            PolygonSymbol[0] = new esri.symbol.SimpleFillSymbol(
                esri.symbol.SimpleFillSymbol.STYLE_SOLID,
                new esri.symbol.SimpleLineSymbol(
                    esri.symbol.SimpleLineSymbol.STYLE_DASHDOT,
                    new dojo.Color([84,255,159]), 0.01),
                new esri.Color([84,255,159,0.6])
            );
            //植物园
            PolygonSymbol[1] = new esri.symbol.SimpleFillSymbol(
                esri.symbol.SimpleFillSymbol.STYLE_SOLID,
                new esri.symbol.SimpleLineSymbol(
                    esri.symbol.SimpleLineSymbol.STYLE_DASHDOT,
                    new dojo.Color([178,34,34]), 0.01),
                new esri.Color([178,34,34,1])
            );

            //园艺小镇
            PolygonSymbol[2] = new esri.symbol.SimpleFillSymbol(
                esri.symbol.SimpleFillSymbol.STYLE_SOLID,
                new esri.symbol.SimpleLineSymbol(
                    esri.symbol.SimpleLineSymbol.STYLE_DASHDOT,
                    new dojo.Color([255,105,180]), 0.01),
                new esri.Color([255,105,180,1])
            );
            //中国馆及其展区
            PolygonSymbol[3] = new esri.symbol.SimpleFillSymbol(
                esri.symbol.SimpleFillSymbol.STYLE_SOLID,
                new esri.symbol.SimpleLineSymbol(
                    esri.symbol.SimpleLineSymbol.STYLE_DASHDOT,
                    new dojo.Color([222,28,49]), 0.01),
                new esri.Color([222,28,49,1])
            );
            //国际馆及其展区
            PolygonSymbol[4] = new esri.symbol.SimpleFillSymbol(
                esri.symbol.SimpleFillSymbol.STYLE_SOLID,
                new esri.symbol.SimpleLineSymbol(
                    esri.symbol.SimpleLineSymbol.STYLE_DASHDOT,
                    new dojo.Color([49,122,167]), 1),
                new esri.Color([49,122,167,1])
            );
            PolygonSymbol[5] = new esri.symbol.SimpleFillSymbol(
                esri.symbol.SimpleFillSymbol.STYLE_SOLID,
                new esri.symbol.SimpleLineSymbol(
                    esri.symbol.SimpleLineSymbol.STYLE_DASHDOT,
                    new dojo.Color([49,122,167]), 1),
                new esri.Color([255,215,0,1])
            );
            //绘制样式
            DrawPolygonSymbol = new esri.symbol.SimpleFillSymbol(
                esri.symbol.SimpleFillSymbol.STYLE_SOLID,
                new esri.symbol.SimpleLineSymbol(
                    esri.symbol.SimpleLineSymbol.STYLE_DASHDOT,
                    new dojo.Color([255,0,0,0]), 0.01),
                new esri.Color([255,0,0,0.25])
            );
            Picture_center= new esri.symbol.PictureFillSymbol('demo.png',
                new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID),
                42, 42);

               var polygon_name = new ArrayBuffer();var polygon_intro = new ArrayBuffer();var polygon_ring = new ArrayBuffer();
                polygon_name[0] ="总园";polygon_intro[0] = "包括植物园，园艺小镇，中国馆，国际馆，生活体验馆等";
                polygon_name[1] ="生活园艺区 ";polygon_intro[1] ="作品“莫莉和她的一家人” 作者：詹姆斯";
                polygon_name[2] ="中华园艺展示区";polygon_intro[2] ="有不同省份的特色园艺";
                polygon_name[3] ="科技发展带";polygon_intro[3] ="扶贫展区，榆树展区";
                polygon_name[4] ="国际馆";polygon_intro[4] = "包括英国、韩国、苏丹等十几个国家在内的园艺展区";
                polygon_name[5] = "自然生态展示区";polygon_intro[5]="流光森林，芦汀林樾";

            newpolygons = new Array(5);
            newpolygons[0] = new esri.geometry.Polygon({
                    "rings": [[[115.938807, 40.438038], [115.943119, 40.439411], [115.959073, 40.441662], [115.96554, 40.442431], [115.971936, 40.451106], [115.973302, 40.452973], [115.974452, 40.457694], [115.974883, 40.458902], [115.972727, 40.459341], [115.972871, 40.461646], [115.961947, 40.460658], [115.953683, 40.459066], [115.954186, 40.453741], [115.951886, 40.452314], [115.946928, 40.45171], [115.945275, 40.450008], [115.939669, 40.44902], [115.939274, 40.438121], [115.938807, 40.438038]]],
                    "spatialReference": {"wkid": 4326}
                });

            newpolygons[1]  = new esri.geometry.Polygon({
                    "rings": [[[115.942616, 40.439301], [115.945167, 40.440015], [115.956126, 40.441223], [115.956126, 40.441223], [115.955408, 40.450392], [115.949515, 40.449953], [115.948509, 40.449651], [115.947359, 40.447812], [115.944197, 40.445396], [115.942616, 40.439301]]],
                    "spatialReference": {"wkid": 4326}
                });

            newpolygons[2]  = new esri.geometry.Polygon({
                    "rings": [[[115.95724, 40.443035], [115.956665, 40.443804], [115.957671, 40.445067], [115.960007, 40.446522], [115.962486, 40.443968], [115.960977, 40.443364], [115.95724, 40.443035]]],
                    "spatialReference": {"wkid": 4326}
                });

            newpolygons[3]  = new esri.geometry.Polygon({
                    "rings": [[[115.958031, 40.441607], [115.965397, 40.442651], [115.972942, 40.452424], [115.969996, 40.452122], [115.965648, 40.445588], [115.963564, 40.444133], [115.9613, 40.443419], [115.957671, 40.442815], [115.958031, 40.441607]]],
                    "spatialReference": {"wkid": 4326}
                });

            newpolygons[4]  = new esri.geometry.Polygon({
                    "rings": [[[115.965792, 40.44729], [115.969385, 40.451326], [115.969888, 40.453083], [115.967157, 40.453275], [115.967157, 40.452396], [115.964534, 40.451957], [115.962881, 40.451271], [115.964498, 40.45009], [115.965001, 40.448416], [115.965181, 40.447839], [115.965792, 40.44729]]],
                    "spatialReference": {"wkid": 4326}
                });

            newpolygons[5]  = new esri.geometry.Polygon({
                    "rings": [[[115.956881, 40.450969], [115.960187, 40.45171], [115.963959, 40.453192], [115.968559, 40.455443], [115.96766, 40.456761], [115.966475, 40.457584], [115.959576, 40.457584], [115.958821, 40.456651], [115.958462, 40.455333], [115.958462, 40.455333], [115.956665, 40.453741], [115.957384, 40.452286], [115.956881, 40.450969]]],
                    "spatialReference": {"wkid": 4326}
                });
            var Template = new esri.InfoTemplate("景点简介", "名称: ${Xcoord} <br/>特色景观: ${Ycoord} ");

        for(k=0;k<6;k++) {
            textPolygonsymbol = new esri.symbol.TextSymbol();
            textPolygonsymbol.setFont(new esri.symbol.Font("20pt").setWeight(esri.symbol.Font.WEIGHT_BOLD));
            textPolygonsymbol.setOffset(0, -20);
            textPolygonsymbol.setColor(new esri.Color([105, 105, 105]));
            var attr = {"Xcoord": polygon_name[k], "Ycoord": polygon_intro[k]};
            graphic1.add(new esri.Graphic(newpolygons[k],PolygonSymbol[k],attr,Template));
            graphicPolygonText = new esri.Graphic(newpolygons[k], textPolygonsymbol.setText(polygon_name[k]));
            graphic1.add(graphicPolygonText);
        }

                //点
                var Templategate = new esri.InfoTemplate("景点","名称: ${Xcoord} <br/>");
                pointname = new ArrayBuffer();point = new ArrayBuffer();
                pointname[0] = "永宁阁";pointname[1] = "湖映苍鹭";pointname[2] = "南门";pointname[3] = "西门";pointname[4] = "东门";pointname[5] = "停车场";pointname[6] = "停车场";pointname[7] = "停车场";
                point[0] = [115.952605,40.44903];point[1] = [115.941897,40.442675];point[2] = [115.946389,40.440094];point[3] = [115.942921,40.449428],point[4] = [115.968954,40.455591];point[5] = [115.949874,40.43868];point[6] = [115.960743,40.440835];point[7] = [115.968882,40.441426];

        for(i=0;i<8;i++) {
            var attrpoint0 = {"Xcoord": pointname[i]};
            var point0 = new esri.geometry.Point(point[i], new esri.SpatialReference({wkid: 4326}));
            var textsymbol = new esri.symbol.TextSymbol();
            textsymbol.setFont(new esri.symbol.Font("11pt").setWeight(esri.symbol.Font.WEIGHT_BOLD));
            textsymbol.setOffset(0, -20);
            textsymbol.setColor(new dojo.Color("#4876FF"));
            graphic1.add(new esri.Graphic(point0, PointSymbol, attrpoint0, Templategate));
            graphicText = new esri.Graphic(point0, textsymbol.setText(pointname[i]));
            graphic1.add(graphicText);
        }
            MyMap.addLayer(graphic1);

            MyMap.on("mouse-over",function (evt) {
                MyMap.infoWindow.hide();
            });
            dojo.connect(MyMap, "onLoad", function (theMyMap) {

                dojo.connect(ToolBar, "onDrawEnd", function (geometry) {
                        if (geometry.type === "polygon") {
                            ToolBar.deactivate();
                            var Grapicture = new esri.Graphic(geometry, DrawPolygonSymbol)
                            MyMap.graphics.add(Grapicture);
                        }
                        if (geometry.type === "polyline") {
                            ToolBar.deactivate();
                            var graphline = new esri.Graphic(geometry, PolyLineSymbol)
                            MyMap.graphics.add(graphline);

                        }
                        if (geometry.type === "point") {
                            ToolBar.deactivate();

                            var graphpoint = new esri.Graphic(geometry, PointSymbol)
                            MyMap.graphics.add(graphpoint);

                        }

                    }
                )
            });


            dojo.connect(MyMap, "onLoad", function () {
                //地图加载后，监听到鼠标移动或拖动事件
                dojo.connect(MyMap, "onMouseDown", showCoordinates);
                // dojo.connect(MyMap, "onMouseDrag", showCoordinates);
            });
        }
        dojo.addOnLoad(init);

        function showCoordinates(evt) {
            lat=  evt.mapPoint.getLatitude();
            lon = evt.mapPoint.getLongitude();
            dojo.byId("info").innerHTML = "["+lon+","+lat+"]";

        }
        dojo.addOnLoad(showCoordinates);


        function fullClick() {
            navToolbar.zoomToFullExtent();
        }
        function backClick() {
            navToolbar.zoomToNextExtent();
        }
        function preClick()  {
            navToolbar.zoomToPrevExtent();
        }
        function DrawPolygonGraphic() {
            ToolBar.activate(esri.toolbars.Draw.POLYGON);
        }
        function DrawPolylineGraphic() {
            ToolBar.activate(esri.toolbars.Draw.POLYLINE);
        }
        function DrawPointGraphic() {
            ToolBar.activate(esri.toolbars.Draw.POINT);
        }
        function ClearGraphic() {
            if (MyMap.graphics != null)
                MyMap.graphics.clear();
        }
        function copyFn(){
            var val = document.getElementById('info');
            window.getSelection().selectAllChildren(val);
            document.execCommand ("Copy");
        }
    </script>
</head>
<body class="tundra">
<div style="float: left;width:200px;margin: 0 auto;height: 500px;">
    <iframe scrolling="no" src="https://tianqiapi.com/api.php?style=tw&skin=pitaya" frameborder="0" width="200" height="500" allowtransparency="true">
    </iframe>
    <p style="text-align:center;font-size:medium;font-family:Helvetica;">作者 zz</p>
</div>
<div style="float:right;width:1050px; margin: 0 auto;">
    <div  style="position:relative;height:110px;width: 1000px; margin: 0 auto;" >
        <div style="float: left;width: 200px;left:0; bottom: 0px; z-index:100000;"><img src="http://images.china.cn/images1/ch/20190415/images/logo.png" width="85" height="80" border="0"></a></div>
        <div class="z_nav" style="position:relative;width: 800px;float:left; overflow:hidden;top:60px;">
            <ul>
                <li style="border-bottom: 1px solid rgb(255, 255, 255);">
                    <div data-dojo-type="dijit.form.DropDownButton">
                        <span>景点</span>
                        <div data-dojo-type="dijit.TooltipDialog">
                            <div id="bookmarks"></div>
                        </div>
                    </div>
                </li>
                <li style="border-bottom: 1px solid rgb(255, 255, 255);">
                    <div data-dojo-type="dijit.form.DropDownButton">
                        <span>绘制功能</span>
                        <div data-dojo-type="dijit.TooltipDialog">
                            <input class="login-button" type="button" value="绘制面"   onclick="DrawPolygonGraphic()" /><br/>
                            <input class="login-button" type="button" value="绘制路线" onclick="DrawPolylineGraphic()" /><br/>
                            <input class="login-button" type="button" value="标记景点" onclick="DrawPointGraphic()" /><br/>
                            <input class="login-button" type="button" value="清除标记" onclick="ClearGraphic()" />
                        </div>
                    </div>
                </li>
                <li style="border-bottom: 1px solid rgb(255, 255, 255);">
                    <div data-dojo-type="dijit.form.DropDownButton">
                        <span>底图更改</span>
                        <div data-dojo-type="dijit.TooltipDialog">
                            <div id="basemapGalleryDiv"></div>
                        </div>
                    </div>
                </li>
                <li style="border-bottom: 1px solid rgb(255, 255, 255);">
                    <div data-dojo-type="dijit.form.DropDownButton">
                        <span>视图导航</span>
                        <div data-dojo-type="dijit.TooltipDialog">
                            <button class="login-button" onclick="preClick()">前一视角</button>
                            <button class="login-button" onclick="fullClick()">全图</button>
                            <button class="login-button" onclick="backClick()">后一视角</button>
                        </div>
                    </div>
                </li>
                <li style="border-bottom: 1px solid rgb(255, 255, 255);">
                    <a href="http://zhsy.horti-expo2019.com/res/static/pc/index.html">网上世园</a>
                </li>
                <li style="border-bottom: 1px solid rgb(255, 255, 255);">
                    <a href="https://tickets.horti-expo2019.com">网上购票</a>
                </li>
                <li style="border-bottom: 1px solid rgb(255, 255, 255);">
                    <a href="http://www.horti-expo2019.com/node_7222042.htm ">新闻中心</a>
                </li>
            </ul>
        </div>
    </div>
    <div id="mapDiv" style="height:480px"></div>
</div>


</body>
</html>
